# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ "Malformed part header"

## üîç ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤

‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î "Malformed part header" ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å:

1. **Content-Type ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** - ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô `multipart/form-data`
2. **‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Form Data ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** - ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• multipart ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
3. **Field Names ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** - ‡∏ä‡∏∑‡πà‡∏≠ field ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà API ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
4. **‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** - ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

## üõ†Ô∏è ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Content-Type
```
Content-Type: multipart/form-data
```

### 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Field Names ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

#### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PUT /api/products/{id}:
- `new_images[]` - ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà (‡πÑ‡∏ü‡∏•‡πå)
- `remove_image_ids[]` - ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)
- ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)

### 3. ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Postman ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

#### Headers:
```
Authorization: Bearer YOUR_JWT_TOKEN
Content-Type: multipart/form-data
```

#### Body (Form-data):
```
Key: title
Value: "‡∏Å‡∏•‡πâ‡∏≠‡∏á DSLR Canon EOS R5 (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï)"
Type: Text

Key: description  
Value: "‡∏Å‡∏•‡πâ‡∏≠‡∏á DSLR ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û"
Type: Text

Key: rental_price_per_day
Value: 1800.00
Type: Text

Key: new_images[]
Value: [‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û]
Type: File

Key: remove_image_ids[]
Value: "1,3"
Type: Text
```

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### 1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Script
```bash
# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç token ‡πÅ‡∏•‡∏∞ product ID ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå
node test-put-upload.js
```

### 2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Postman
1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Method ‡πÄ‡∏õ‡πá‡∏ô `PUT`
2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡πÄ‡∏õ‡πá‡∏ô `http://localhost:3001/api/products/{id}`
3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Headers ‡∏ï‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
4. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Body ‡πÄ‡∏õ‡πá‡∏ô `form-data`
5. ‡πÄ‡∏û‡∏¥‡πà‡∏° fields ‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

## ‚ö†Ô∏è ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á

### 1. Field Names
- ‡πÉ‡∏ä‡πâ `new_images[]` ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà `images[]` (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PUT)
- ‡πÉ‡∏ä‡πâ `remove_image_ids[]` ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà `remove_image_ids`

### 2. File Upload
- ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (JPEG, PNG, etc.)
- ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB
- ‡πÉ‡∏ä‡πâ field name ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### 3. Text Fields
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô string
- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô string ‡∏´‡∏£‡∏∑‡∏≠ number
- JSON ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô string

## üîß ‡∏Å‡∏≤‡∏£ Debug

### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Logs
Server ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á logs:
```
Upload middleware processing fields: [...]
Files received: {...}
Body received: {...}
```

### 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Request
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Content-Type header
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö field names
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö file types

### 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Response
- ‡∏î‡∏π error message ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö status code

## üìù ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### Minimal Update (‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå):
```
PUT /api/products/1
Content-Type: multipart/form-data
Authorization: Bearer token

Body:
title: "‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà"
description: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏´‡∏°‡πà"
```

### Update with Images:
```
PUT /api/products/1
Content-Type: multipart/form-data
Authorization: Bearer token

Body:
title: "‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà"
new_images[]: [‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û]
remove_image_ids[]: "1,2"
```

## üö® Error Messages ‡πÉ‡∏´‡∏°‡πà

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ error messages ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô:

- `Content-Type must be multipart/form-data`
- `Invalid form data format. Please check your request structure.`
- `File is too large. Max 5MB allowed.`
- `Only image files are allowed!` 